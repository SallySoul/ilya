"use strict";

class CalculatorApp {
  constructor(display_element) {
    this.display_element = display_element;
    this.clear();
  }

  clear() {
    this.current_op = "null";
    this.register = "";
    this.result = 0.0;
    this.display_element.display(0);
  } // Used when an operation is entered


  pushRegister() {
    this.result = parseFloat(this.register);
    this.register = "";
  }

  enter_digit(digit) {
    this.register += String(digit);
    this.display_element.display(parseFloat(this.register));
  }

  decimal() {
    this.register += ".";
    this.display_element.display(this.register);
  }

  add_op() {
    this.current_op = "add";
    this.pushRegister();
  }

  sub_op() {
    // Sub is special cased:
    // If the current op is not null and register is empty
    // then we will interpret the register as negative
    if (this.current_op != "null" && this.register == "") {
      this.register += "-";
      this.display_element.display(parseFloat(this.register));
    } else {
      this.current_op = "sub";
      this.pushRegister();
    }
  }

  mul_op() {
    this.current_op = "mul";
    this.pushRegister();
  }

  div_op() {
    this.current_op = "div";
    this.pushRegister();
  }

  enter() {
    // Do nothing for empty register
    if (this.register == "" || this.registor == "-") {
      return;
    }

    var old_result = this.result;
    var old_register = parseFloat(this.register);
    var new_result = old_result;

    if (this.current_op == "add") {
      new_result = old_result + old_register;
    } else if (this.current_op == "sub") {
      new_result = old_result - old_register;
    } else if (this.current_op == "mul") {
      new_result = old_result * old_register;
    } else if (this.current_op == "div") {
      new_result = old_result / old_register;
    }

    this.result = new_result;
    this.register = String(new_result);
    this.display_element.display(this.result);
  }

}

class TextDisplay {
  constructor(text_element) {
    this.text_element = text_element;
  }

  display(message) {
    this.text_element.textContent = String(message);
  }

} // Javascript "closures" capture by reference not value
// soo you have to capture parameters instead?


function digit_callback(calculator, digit) {
  return function () {
    calculator.enter_digit(digit);
  };
} // Helper function for binding a callback to a button


function bindButton(document, id, callback) {
  var button = document.getElementById(id);

  if (button == null) {
    console.error(id + " not found");
    return;
  }

  button.addEventListener("click", callback);
} // Create an instance of CalculatorApp and bind it to an svg_document


function bindCalculatorApp(svg_document) {
  var display_element = svg_document.getElementById("display");

  if (display_element == null) {
    console.error("display not found");
    return;
  }

  var display = new TextDisplay(display_element);
  var calculator = new CalculatorApp(display); // Add the 0-9 digit buttons

  for (var i = 0; i < 10; i++) {
    var digit = String(i);
    var button_name = "button_" + digit;
    bindButton(svg_document, button_name, digit_callback(calculator, digit));
  } // All the other buttons


  bindButton(svg_document, "button_decimal", function () {
    calculator.decimal();
  });
  bindButton(svg_document, "button_add", function () {
    calculator.add_op();
  });
  bindButton(svg_document, "button_sub", function () {
    calculator.sub_op();
  });
  bindButton(svg_document, "button_mul", function () {
    calculator.mul_op();
  });
  bindButton(svg_document, "button_div", function () {
    calculator.div_op();
  });
  bindButton(svg_document, "button_enter", function () {
    calculator.enter();
  });
  bindButton(svg_document, "button_clear", function () {
    calculator.clear();
  });
}

function init() {
  var svg_object = document.getElementById("svg_object");

  if (svg_object == null) {
    console.error("svg_object not found!");
    return;
  } // We don't can't bind the calculator app
  // until the svg is loaded


  svg_object.addEventListener("load", function () {
    console.log("SVG contentDocument Loaded!");

    if (svg_object.contentDocument == null) {
      console.error("contentDocument is still null!");
    } else {
      bindCalculatorApp(svg_object.contentDocument);
    }
  }, false);
}

init();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJDYWxjdWxhdG9yQXBwIiwiY29uc3RydWN0b3IiLCJkaXNwbGF5X2VsZW1lbnQiLCJjbGVhciIsImN1cnJlbnRfb3AiLCJyZWdpc3RlciIsInJlc3VsdCIsImRpc3BsYXkiLCJwdXNoUmVnaXN0ZXIiLCJwYXJzZUZsb2F0IiwiZW50ZXJfZGlnaXQiLCJkaWdpdCIsIlN0cmluZyIsImRlY2ltYWwiLCJhZGRfb3AiLCJzdWJfb3AiLCJtdWxfb3AiLCJkaXZfb3AiLCJlbnRlciIsInJlZ2lzdG9yIiwib2xkX3Jlc3VsdCIsIm9sZF9yZWdpc3RlciIsIm5ld19yZXN1bHQiLCJUZXh0RGlzcGxheSIsInRleHRfZWxlbWVudCIsIm1lc3NhZ2UiLCJ0ZXh0Q29udGVudCIsImRpZ2l0X2NhbGxiYWNrIiwiY2FsY3VsYXRvciIsImJpbmRCdXR0b24iLCJkb2N1bWVudCIsImlkIiwiY2FsbGJhY2siLCJidXR0b24iLCJnZXRFbGVtZW50QnlJZCIsImNvbnNvbGUiLCJlcnJvciIsImFkZEV2ZW50TGlzdGVuZXIiLCJiaW5kQ2FsY3VsYXRvckFwcCIsInN2Z19kb2N1bWVudCIsImkiLCJidXR0b25fbmFtZSIsImluaXQiLCJzdmdfb2JqZWN0IiwibG9nIiwiY29udGVudERvY3VtZW50Il0sIm1hcHBpbmdzIjoiOztBQUFBLE1BQU1BLGFBQU4sQ0FBb0I7QUFDbEJDLEVBQUFBLFdBQVcsQ0FBQ0MsZUFBRCxFQUFrQjtBQUMzQixTQUFLQSxlQUFMLEdBQXVCQSxlQUF2QjtBQUNBLFNBQUtDLEtBQUw7QUFDRDs7QUFFREEsRUFBQUEsS0FBSyxHQUFHO0FBQ04sU0FBS0MsVUFBTCxHQUFrQixNQUFsQjtBQUNBLFNBQUtDLFFBQUwsR0FBZ0IsRUFBaEI7QUFDQSxTQUFLQyxNQUFMLEdBQWMsR0FBZDtBQUNBLFNBQUtKLGVBQUwsQ0FBcUJLLE9BQXJCLENBQTZCLENBQTdCO0FBQ0QsR0FYaUIsQ0FhbEI7OztBQUNBQyxFQUFBQSxZQUFZLEdBQUc7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QUFYLENBQ0UsTUFERixFQUVFLFlBQVc7QUFDVEYsSUFBQUEsT0FBTyxDQUFDUyxHQUFSLENBQVksNkJBQVo7O0FBQ0EsUUFBSUQsVUFBVSxDQUFDRSxlQUFYLElBQThCLElBQWxDLEVBQXdDO0FBQ3RDVixNQUFBQSxPQUFPLENBQUNDLEtBQVIsQ0FBYyxnQ0FBZDtBQUNELEtBRkQsTUFFTztBQUNMRSxNQUFBQSxpQkFBaUIsQ0FBQ0ssVUFBVSxDQUFDRSxlQUFaLENBQWpCO0FBQ0Q7QUFDRixHQVRILEVBVUUsS0FWRjtBQVlEOztBQUVESCxJQUFJIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgQ2FsY3VsYXRvckFwcCB7XG4gIGNvbnN0cnVjdG9yKGRpc3BsYXlfZWxlbWVudCkge1xuICAgIHRoaXMuZGlzcGxheV9lbGVtZW50ID0gZGlzcGxheV9lbGVtZW50O1xuICAgIHRoaXMuY2xlYXIoKTtcbiAgfVxuXG4gIGNsZWFyKCkge1xuICAgIHRoaXMuY3VycmVudF9vcCA9IFwibnVsbFwiO1xuICAgIHRoaXMucmVnaXN0ZXIgPSBcIlwiO1xuICAgIHRoaXMucmVzdWx0ID0gMC4wO1xuICAgIHRoaXMuZGlzcGxheV9lbGVtZW50LmRpc3BsYXkoMCk7XG4gIH1cblxuICAvLyBVc2VkIHdoZW4gYW4gb3BlcmF0aW9uIGlzIGVudGVyZWRcbiAgcHVzaFJlZ2lzdGVyKCkge1xuICAgIHRoaXMucmVzdWx0ID0gcGFyc2VGbG9hdCh0aGlzLnJlZ2lzdGVyKTtcbiAgICB0aGlzLnJlZ2lzdGVyID0gXCJcIjtcbiAgfVxuXG4gIGVudGVyX2RpZ2l0KGRpZ2l0KSB7XG4gICAgdGhpcy5yZWdpc3RlciArPSBTdHJpbmcoZGlnaXQpO1xuICAgIHRoaXMuZGlzcGxheV9lbGVtZW50LmRpc3BsYXkocGFyc2VGbG9hdCh0aGlzLnJlZ2lzdGVyKSk7XG4gIH1cblxuICBkZWNpbWFsKCkge1xuICAgIHRoaXMucmVnaXN0ZXIgKz0gXCIuXCI7XG4gICAgdGhpcy5kaXNwbGF5X2VsZW1lbnQuZGlzcGxheSh0aGlzLnJlZ2lzdGVyKTtcbiAgfVxuXG4gIGFkZF9vcCgpIHtcbiAgICB0aGlzLmN1cnJlbnRfb3AgPSBcImFkZFwiO1xuICAgIHRoaXMucHVzaFJlZ2lzdGVyKCk7XG4gIH1cblxuICBzdWJfb3AoKSB7XG4gICAgLy8gU3ViIGlzIHNwZWNpYWwgY2FzZWQ6XG4gICAgLy8gSWYgdGhlIGN1cnJlbnQgb3AgaXMgbm90IG51bGwgYW5kIHJlZ2lzdGVyIGlzIGVtcHR5XG4gICAgLy8gdGhlbiB3ZSB3aWxsIGludGVycHJldCB0aGUgcmVnaXN0ZXIgYXMgbmVnYXRpdmVcbiAgICBpZiAodGhpcy5jdXJyZW50X29wICE9IFwibnVsbFwiICYmIHRoaXMucmVnaXN0ZXIgPT0gXCJcIikge1xuICAgICAgdGhpcy5yZWdpc3RlciArPSBcIi1cIjtcbiAgICAgIHRoaXMuZGlzcGxheV9lbGVtZW50LmRpc3BsYXkocGFyc2VGbG9hdCh0aGlzLnJlZ2lzdGVyKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY3VycmVudF9vcCA9IFwic3ViXCI7XG4gICAgICB0aGlzLnB1c2hSZWdpc3RlcigpO1xuICAgIH1cbiAgfVxuXG4gIG11bF9vcCgpIHtcbiAgICB0aGlzLmN1cnJlbnRfb3AgPSBcIm11bFwiO1xuICAgIHRoaXMucHVzaFJlZ2lzdGVyKCk7XG4gIH1cblxuICBkaXZfb3AoKSB7XG4gICAgdGhpcy5jdXJyZW50X29wID0gXCJkaXZcIjtcbiAgICB0aGlzLnB1c2hSZWdpc3RlcigpO1xuICB9XG5cbiAgZW50ZXIoKSB7XG4gICAgLy8gRG8gbm90aGluZyBmb3IgZW1wdHkgcmVnaXN0ZXJcbiAgICBpZiAodGhpcy5yZWdpc3RlciA9PSBcIlwiIHx8IHRoaXMucmVnaXN0b3IgPT0gXCItXCIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgb2xkX3Jlc3VsdCA9IHRoaXMucmVzdWx0O1xuICAgIHZhciBvbGRfcmVnaXN0ZXIgPSBwYXJzZUZsb2F0KHRoaXMucmVnaXN0ZXIpO1xuICAgIHZhciBuZXdfcmVzdWx0ID0gb2xkX3Jlc3VsdDtcbiAgICBpZiAodGhpcy5jdXJyZW50X29wID09IFwiYWRkXCIpIHtcbiAgICAgIG5ld19yZXN1bHQgPSBvbGRfcmVzdWx0ICsgb2xkX3JlZ2lzdGVyO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jdXJyZW50X29wID09IFwic3ViXCIpIHtcbiAgICAgIG5ld19yZXN1bHQgPSBvbGRfcmVzdWx0IC0gb2xkX3JlZ2lzdGVyO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jdXJyZW50X29wID09IFwibXVsXCIpIHtcbiAgICAgIG5ld19yZXN1bHQgPSBvbGRfcmVzdWx0ICogb2xkX3JlZ2lzdGVyO1xuICAgIH0gZWxzZSBpZiAodGhpcy5jdXJyZW50X29wID09IFwiZGl2XCIpIHtcbiAgICAgIG5ld19yZXN1bHQgPSBvbGRfcmVzdWx0IC8gb2xkX3JlZ2lzdGVyO1xuICAgIH1cbiAgICB0aGlzLnJlc3VsdCA9IG5ld19yZXN1bHQ7XG4gICAgdGhpcy5yZWdpc3RlciA9IFN0cmluZyhuZXdfcmVzdWx0KTtcbiAgICB0aGlzLmRpc3BsYXlfZWxlbWVudC5kaXNwbGF5KHRoaXMucmVzdWx0KTtcbiAgfVxufVxuXG5jbGFzcyBUZXh0RGlzcGxheSB7XG4gIGNvbnN0cnVjdG9yKHRleHRfZWxlbWVudCkge1xuICAgIHRoaXMudGV4dF9lbGVtZW50ID0gdGV4dF9lbGVtZW50O1xuICB9XG5cbiAgZGlzcGxheShtZXNzYWdlKSB7XG4gICAgdGhpcy50ZXh0X2VsZW1lbnQudGV4dENvbnRlbnQgPSBTdHJpbmcobWVzc2FnZSk7XG4gIH1cbn1cblxuLy8gSmF2YXNjcmlwdCBcImNsb3N1cmVzXCIgY2FwdHVyZSBieSByZWZlcmVuY2Ugbm90IHZhbHVlXG4vLyBzb28geW91IGhhdmUgdG8gY2FwdHVyZSBwYXJhbWV0ZXJzIGluc3RlYWQ/XG5mdW5jdGlvbiBkaWdpdF9jYWxsYmFjayhjYWxjdWxhdG9yLCBkaWdpdCkge1xuICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgY2FsY3VsYXRvci5lbnRlcl9kaWdpdChkaWdpdCk7XG4gIH07XG59XG5cbi8vIEhlbHBlciBmdW5jdGlvbiBmb3IgYmluZGluZyBhIGNhbGxiYWNrIHRvIGEgYnV0dG9uXG5mdW5jdGlvbiBiaW5kQnV0dG9uKGRvY3VtZW50LCBpZCwgY2FsbGJhY2spIHtcbiAgdmFyIGJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTtcbiAgaWYgKGJ1dHRvbiA9PSBudWxsKSB7XG4gICAgY29uc29sZS5lcnJvcihpZCArIFwiIG5vdCBmb3VuZFwiKTtcbiAgICByZXR1cm47XG4gIH1cbiAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjYWxsYmFjayk7XG59XG5cbi8vIENyZWF0ZSBhbiBpbnN0YW5jZSBvZiBDYWxjdWxhdG9yQXBwIGFuZCBiaW5kIGl0IHRvIGFuIHN2Z19kb2N1bWVudFxuZnVuY3Rpb24gYmluZENhbGN1bGF0b3JBcHAoc3ZnX2RvY3VtZW50KSB7XG4gIHZhciBkaXNwbGF5X2VsZW1lbnQgPSBzdmdfZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkaXNwbGF5XCIpO1xuICBpZiAoZGlzcGxheV9lbGVtZW50ID09IG51bGwpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiZGlzcGxheSBub3QgZm91bmRcIik7XG4gICAgcmV0dXJuO1xuICB9XG4gIHZhciBkaXNwbGF5ID0gbmV3IFRleHREaXNwbGF5KGRpc3BsYXlfZWxlbWVudCk7XG4gIHZhciBjYWxjdWxhdG9yID0gbmV3IENhbGN1bGF0b3JBcHAoZGlzcGxheSk7XG5cbiAgLy8gQWRkIHRoZSAwLTkgZGlnaXQgYnV0dG9uc1xuICBmb3IgKHZhciBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICB2YXIgZGlnaXQgPSBTdHJpbmcoaSk7XG4gICAgdmFyIGJ1dHRvbl9uYW1lID0gXCJidXR0b25fXCIgKyBkaWdpdDtcbiAgICBiaW5kQnV0dG9uKHN2Z19kb2N1bWVudCwgYnV0dG9uX25hbWUsIGRpZ2l0X2NhbGxiYWNrKGNhbGN1bGF0b3IsIGRpZ2l0KSk7XG4gIH1cblxuICAvLyBBbGwgdGhlIG90aGVyIGJ1dHRvbnNcbiAgYmluZEJ1dHRvbihzdmdfZG9jdW1lbnQsIFwiYnV0dG9uX2RlY2ltYWxcIiwgZnVuY3Rpb24oKSB7XG4gICAgY2FsY3VsYXRvci5kZWNpbWFsKCk7XG4gIH0pO1xuICBiaW5kQnV0dG9uKHN2Z19kb2N1bWVudCwgXCJidXR0b25fYWRkXCIsIGZ1bmN0aW9uKCkge1xuICAgIGNhbGN1bGF0b3IuYWRkX29wKCk7XG4gIH0pO1xuICBiaW5kQnV0dG9uKHN2Z19kb2N1bWVudCwgXCJidXR0b25fc3ViXCIsIGZ1bmN0aW9uKCkge1xuICAgIGNhbGN1bGF0b3Iuc3ViX29wKCk7XG4gIH0pO1xuICBiaW5kQnV0dG9uKHN2Z19kb2N1bWVudCwgXCJidXR0b25fbXVsXCIsIGZ1bmN0aW9uKCkge1xuICAgIGNhbGN1bGF0b3IubXVsX29wKCk7XG4gIH0pO1xuICBiaW5kQnV0dG9uKHN2Z19kb2N1bWVudCwgXCJidXR0b25fZGl2XCIsIGZ1bmN0aW9uKCkge1xuICAgIGNhbGN1bGF0b3IuZGl2X29wKCk7XG4gIH0pO1xuICBiaW5kQnV0dG9uKHN2Z19kb2N1bWVudCwgXCJidXR0b25fZW50ZXJcIiwgZnVuY3Rpb24oKSB7XG4gICAgY2FsY3VsYXRvci5lbnRlcigpO1xuICB9KTtcbiAgYmluZEJ1dHRvbihzdmdfZG9jdW1lbnQsIFwiYnV0dG9uX2NsZWFyXCIsIGZ1bmN0aW9uKCkge1xuICAgIGNhbGN1bGF0b3IuY2xlYXIoKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGluaXQoKSB7XG4gIHZhciBzdmdfb2JqZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdmdfb2JqZWN0XCIpO1xuICBpZiAoc3ZnX29iamVjdCA9PSBudWxsKSB7XG4gICAgY29uc29sZS5lcnJvcihcInN2Z19vYmplY3Qgbm90IGZvdW5kIVwiKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBXZSBkb24ndCBjYW4ndCBiaW5kIHRoZSBjYWxjdWxhdG9yIGFwcFxuICAvLyB1bnRpbCB0aGUgc3ZnIGlzIGxvYWRlZFxuICBzdmdfb2JqZWN0LmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgXCJsb2FkXCIsXG4gICAgZnVuY3Rpb24oKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIlNWRyBjb250ZW50RG9jdW1lbnQgTG9hZGVkIVwiKTtcbiAgICAgIGlmIChzdmdfb2JqZWN0LmNvbnRlbnREb2N1bWVudCA9PSBudWxsKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJjb250ZW50RG9jdW1lbnQgaXMgc3RpbGwgbnVsbCFcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBiaW5kQ2FsY3VsYXRvckFwcChzdmdfb2JqZWN0LmNvbnRlbnREb2N1bWVudCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBmYWxzZVxuICApO1xufVxuXG5pbml0KCk7XG4iXSwiZmlsZSI6ImFwcC5qcyJ9
