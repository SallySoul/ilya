"use strict";

var ilya_node = require('ilya_node');

class CalculatorApp {
  constructor(display_element) {
    this.display_element = display_element;
    this.clear();
  }

  clear() {
    this.current_op = "null";
    this.register = "";
    this.result = 0.0;
    this.display_element.display(0);
  } // Used when an operation is entered


  pushRegister() {
    this.result = parseFloat(this.register);
    this.register = "";
  }

  enter_digit(digit) {
    this.register += String(digit);
    this.display_element.display(parseFloat(this.register));
  }

  decimal() {
    this.register += ".";
    this.display_element.display(this.register);
  }

  add_op() {
    this.current_op = "add";
    this.pushRegister();
  }

  sub_op() {
    // Sub is special cased:
    // If the current op is not null and register is empty
    // then we will interpret the register as negative
    if (this.current_op != "null" && this.register == "") {
      this.register += "-";
      this.display_element.display(parseFloat(this.register));
    } else {
      this.current_op = "sub";
      this.pushRegister();
    }
  }

  mul_op() {
    this.current_op = "mul";
    this.pushRegister();
  }

  div_op() {
    this.current_op = "div";
    this.pushRegister();
  }

  enter() {
    // Do nothing for empty register
    if (this.register == "" || this.registor == "-") {
      return;
    }

    var old_result = this.result;
    var old_register = parseFloat(this.register);
    var new_result = old_result;

    if (this.current_op == "add") {
      new_result = old_result + old_register;
    } else if (this.current_op == "sub") {
      new_result = old_result - old_register;
    } else if (this.current_op == "mul") {
      new_result = old_result * old_register;
    } else if (this.current_op == "div") {
      new_result = old_result / old_register;
    }

    this.result = new_result;
    this.register = String(new_result);
    this.display_element.display(this.result);
  }

}

class TextDisplay {
  constructor(text_element) {
    this.text_element = text_element;
  }

  display(message) {
    this.text_element.textContent = String(message);
  }

} // Javascript "closures" capture by reference not value
// soo you have to capture parameters instead?


function digit_callback(calculator, digit) {
  return function () {
    calculator.enter_digit(digit);
  };
} // Helper function for binding a callback to a button


function bindButton(document, id, callback) {
  var button = document.getElementById(id);

  if (button == null) {
    console.error(id + " not found");
    return;
  }

  button.addEventListener("click", callback);
} // Create an instance of CalculatorApp and bind it to an svg_document


function bindCalculatorApp(svg_document) {
  var display_element = svg_document.getElementById("display");

  if (display_element == null) {
    console.error("display not found");
    return;
  }

  var display = new TextDisplay(display_element);
  var calculator = new CalculatorApp(display); // Add the 0-9 digit buttons

  for (var i = 0; i < 10; i++) {
    var digit = String(i);
    var button_name = "button_" + digit;
    bindButton(svg_document, button_name, digit_callback(calculator, digit));
  } // All the other buttons


  bindButton(svg_document, "button_decimal", function () {
    calculator.decimal();
  });
  bindButton(svg_document, "button_add", function () {
    calculator.add_op();
  });
  bindButton(svg_document, "button_sub", function () {
    calculator.sub_op();
  });
  bindButton(svg_document, "button_mul", function () {
    calculator.mul_op();
  });
  bindButton(svg_document, "button_div", function () {
    calculator.div_op();
  });
  bindButton(svg_document, "button_enter", function () {
    calculator.enter();
  });
  bindButton(svg_document, "button_clear", function () {
    calculator.clear();
  });
}

function init() {
  var asset_map = new ilya_node.StaticAssetMap();
  var svg_object = document.getElementById("svg_object");

  if (svg_object == null) {
    console.error("svg_object not found!");
    return;
  }

  svg_object.innerHTML = asset_map.get("layout.svg");
  bindCalculatorApp(document);
}

init();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJpbHlhX25vZGUiLCJyZXF1aXJlIiwiQ2FsY3VsYXRvckFwcCIsImNvbnN0cnVjdG9yIiwiZGlzcGxheV9lbGVtZW50IiwiY2xlYXIiLCJjdXJyZW50X29wIiwicmVnaXN0ZXIiLCJyZXN1bHQiLCJkaXNwbGF5IiwicHVzaFJlZ2lzdGVyIiwicGFyc2VGbG9hdCIsImVudGVyX2RpZ2l0IiwiZGlnaXQiLCJTdHJpbmciLCJkZWNpbWFsIiwiYWRkX29wIiwic3ViX29wIiwibXVsX29wIiwiZGl2X29wIiwiZW50ZXIiLCJyZWdpc3RvciIsIm9sZF9yZXN1bHQiLCJvbGRfcmVnaXN0ZXIiLCJuZXdfcmVzdWx0IiwiVGV4dERpc3BsYXkiLCJ0ZXh0X2VsZW1lbnQiLCJtZXNzYWdlIiwidGV4dENvbnRlbnQiLCJkaWdpdF9jYWxsYmFjayIsImNhbGN1bGF0b3IiLCJiaW5kQnV0dG9uIiwiZG9jdW1lbnQiLCJpZCIsImNhbGxiYWNrIiwiYnV0dG9uIiwiZ2V0RWxlbWVudEJ5SWQiLCJjb25zb2xlIiwiZXJyb3IiLCJhZGRFdmVudExpc3RlbmVyIiwiYmluZENhbGN1bGF0b3JBcHAiLCJzdmdfZG9jdW1lbnQiLCJpIiwiYnV0dG9uX25hbWUiLCJpbml0IiwiYXNzZXRfbWFwIiwiU3RhdGljQXNzZXRNYXAiLCJzdmdfb2JqZWN0IiwiaW5uZXJIVE1MIiwiZ2V0Il0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUlBLFNBQVMsR0FBR0MsT0FBTyxDQUFDLFdBQUQsQ0FBdkI7O0FBRUEsTUFBTUMsYUFBTixDQUFvQjtBQUNsQkMsRUFBQUEsV0FBVyxDQUFDQyxlQUFELEVBQWtCO0FBQzNCLFNBQUtBLGVBQUwsR0FBdUJBLGVBQXZCO0FBQ0EsU0FBS0MsS0FBTDtBQUNEOztBQUVEQSxFQUFBQSxLQUFLLEdBQUc7QUFDTixTQUFLQyxVQUFMLEdBQWtCLE1BQWxCO0FBQ0EsU0FBS0MsUUFBTCxHQUFnQixFQUFoQjtBQUNBLFNBQUtDLE1BQUwsR0FB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QixZQUF4QixDQUFqQjs7QUFDQSxNQUFJVyxVQUFVLElBQUksSUFBbEIsRUFBd0I7QUFDdEJWLElBQUFBLE9BQU8sQ0FBQ0MsS0FBUixDQUFjLHVCQUFkO0FBQ0E7QUFDRDs7QUFDRFMsRUFBQUEsVUFBVSxDQUFDQyxTQUFYLEdBQXVCSCxTQUFTLENBQUNJLEdBQVYsQ0FBYyxZQUFkLENBQXZCO0FBQ0FULEVBQUFBLGlCQUFpQixDQUFDUixRQUFELENBQWpCO0FBQ0Q7O0FBRURZLElBQUkiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgaWx5YV9ub2RlID0gcmVxdWlyZSgnaWx5YV9ub2RlJyk7XG5cbmNsYXNzIENhbGN1bGF0b3JBcHAge1xuICBjb25zdHJ1Y3RvcihkaXNwbGF5X2VsZW1lbnQpIHtcbiAgICB0aGlzLmRpc3BsYXlfZWxlbWVudCA9IGRpc3BsYXlfZWxlbWVudDtcbiAgICB0aGlzLmNsZWFyKCk7XG4gIH1cblxuICBjbGVhcigpIHtcbiAgICB0aGlzLmN1cnJlbnRfb3AgPSBcIm51bGxcIjtcbiAgICB0aGlzLnJlZ2lzdGVyID0gXCJcIjtcbiAgICB0aGlzLnJlc3VsdCA9IDAuMDtcbiAgICB0aGlzLmRpc3BsYXlfZWxlbWVudC5kaXNwbGF5KDApO1xuICB9XG5cbiAgLy8gVXNlZCB3aGVuIGFuIG9wZXJhdGlvbiBpcyBlbnRlcmVkXG4gIHB1c2hSZWdpc3RlcigpIHtcbiAgICB0aGlzLnJlc3VsdCA9IHBhcnNlRmxvYXQodGhpcy5yZWdpc3Rlcik7XG4gICAgdGhpcy5yZWdpc3RlciA9IFwiXCI7XG4gIH1cblxuICBlbnRlcl9kaWdpdChkaWdpdCkge1xuICAgIHRoaXMucmVnaXN0ZXIgKz0gU3RyaW5nKGRpZ2l0KTtcbiAgICB0aGlzLmRpc3BsYXlfZWxlbWVudC5kaXNwbGF5KHBhcnNlRmxvYXQodGhpcy5yZWdpc3RlcikpO1xuICB9XG5cbiAgZGVjaW1hbCgpIHtcbiAgICB0aGlzLnJlZ2lzdGVyICs9IFwiLlwiO1xuICAgIHRoaXMuZGlzcGxheV9lbGVtZW50LmRpc3BsYXkodGhpcy5yZWdpc3Rlcik7XG4gIH1cblxuICBhZGRfb3AoKSB7XG4gICAgdGhpcy5jdXJyZW50X29wID0gXCJhZGRcIjtcbiAgICB0aGlzLnB1c2hSZWdpc3RlcigpO1xuICB9XG5cbiAgc3ViX29wKCkge1xuICAgIC8vIFN1YiBpcyBzcGVjaWFsIGNhc2VkOlxuICAgIC8vIElmIHRoZSBjdXJyZW50IG9wIGlzIG5vdCBudWxsIGFuZCByZWdpc3RlciBpcyBlbXB0eVxuICAgIC8vIHRoZW4gd2Ugd2lsbCBpbnRlcnByZXQgdGhlIHJlZ2lzdGVyIGFzIG5lZ2F0aXZlXG4gICAgaWYgKHRoaXMuY3VycmVudF9vcCAhPSBcIm51bGxcIiAmJiB0aGlzLnJlZ2lzdGVyID09IFwiXCIpIHtcbiAgICAgIHRoaXMucmVnaXN0ZXIgKz0gXCItXCI7XG4gICAgICB0aGlzLmRpc3BsYXlfZWxlbWVudC5kaXNwbGF5KHBhcnNlRmxvYXQodGhpcy5yZWdpc3RlcikpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmN1cnJlbnRfb3AgPSBcInN1YlwiO1xuICAgICAgdGhpcy5wdXNoUmVnaXN0ZXIoKTtcbiAgICB9XG4gIH1cblxuICBtdWxfb3AoKSB7XG4gICAgdGhpcy5jdXJyZW50X29wID0gXCJtdWxcIjtcbiAgICB0aGlzLnB1c2hSZWdpc3RlcigpO1xuICB9XG5cbiAgZGl2X29wKCkge1xuICAgIHRoaXMuY3VycmVudF9vcCA9IFwiZGl2XCI7XG4gICAgdGhpcy5wdXNoUmVnaXN0ZXIoKTtcbiAgfVxuXG4gIGVudGVyKCkge1xuICAgIC8vIERvIG5vdGhpbmcgZm9yIGVtcHR5IHJlZ2lzdGVyXG4gICAgaWYgKHRoaXMucmVnaXN0ZXIgPT0gXCJcIiB8fCB0aGlzLnJlZ2lzdG9yID09IFwiLVwiKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIG9sZF9yZXN1bHQgPSB0aGlzLnJlc3VsdDtcbiAgICB2YXIgb2xkX3JlZ2lzdGVyID0gcGFyc2VGbG9hdCh0aGlzLnJlZ2lzdGVyKTtcbiAgICB2YXIgbmV3X3Jlc3VsdCA9IG9sZF9yZXN1bHQ7XG4gICAgaWYgKHRoaXMuY3VycmVudF9vcCA9PSBcImFkZFwiKSB7XG4gICAgICBuZXdfcmVzdWx0ID0gb2xkX3Jlc3VsdCArIG9sZF9yZWdpc3RlcjtcbiAgICB9IGVsc2UgaWYgKHRoaXMuY3VycmVudF9vcCA9PSBcInN1YlwiKSB7XG4gICAgICBuZXdfcmVzdWx0ID0gb2xkX3Jlc3VsdCAtIG9sZF9yZWdpc3RlcjtcbiAgICB9IGVsc2UgaWYgKHRoaXMuY3VycmVudF9vcCA9PSBcIm11bFwiKSB7XG4gICAgICBuZXdfcmVzdWx0ID0gb2xkX3Jlc3VsdCAqIG9sZF9yZWdpc3RlcjtcbiAgICB9IGVsc2UgaWYgKHRoaXMuY3VycmVudF9vcCA9PSBcImRpdlwiKSB7XG4gICAgICBuZXdfcmVzdWx0ID0gb2xkX3Jlc3VsdCAvIG9sZF9yZWdpc3RlcjtcbiAgICB9XG4gICAgdGhpcy5yZXN1bHQgPSBuZXdfcmVzdWx0O1xuICAgIHRoaXMucmVnaXN0ZXIgPSBTdHJpbmcobmV3X3Jlc3VsdCk7XG4gICAgdGhpcy5kaXNwbGF5X2VsZW1lbnQuZGlzcGxheSh0aGlzLnJlc3VsdCk7XG4gIH1cbn1cblxuY2xhc3MgVGV4dERpc3BsYXkge1xuICBjb25zdHJ1Y3Rvcih0ZXh0X2VsZW1lbnQpIHtcbiAgICB0aGlzLnRleHRfZWxlbWVudCA9IHRleHRfZWxlbWVudDtcbiAgfVxuXG4gIGRpc3BsYXkobWVzc2FnZSkge1xuICAgIHRoaXMudGV4dF9lbGVtZW50LnRleHRDb250ZW50ID0gU3RyaW5nKG1lc3NhZ2UpO1xuICB9XG59XG5cbi8vIEphdmFzY3JpcHQgXCJjbG9zdXJlc1wiIGNhcHR1cmUgYnkgcmVmZXJlbmNlIG5vdCB2YWx1ZVxuLy8gc29vIHlvdSBoYXZlIHRvIGNhcHR1cmUgcGFyYW1ldGVycyBpbnN0ZWFkP1xuZnVuY3Rpb24gZGlnaXRfY2FsbGJhY2soY2FsY3VsYXRvciwgZGlnaXQpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgIGNhbGN1bGF0b3IuZW50ZXJfZGlnaXQoZGlnaXQpO1xuICB9O1xufVxuXG4vLyBIZWxwZXIgZnVuY3Rpb24gZm9yIGJpbmRpbmcgYSBjYWxsYmFjayB0byBhIGJ1dHRvblxuZnVuY3Rpb24gYmluZEJ1dHRvbihkb2N1bWVudCwgaWQsIGNhbGxiYWNrKSB7XG4gIHZhciBidXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7XG4gIGlmIChidXR0b24gPT0gbnVsbCkge1xuICAgIGNvbnNvbGUuZXJyb3IoaWQgKyBcIiBub3QgZm91bmRcIik7XG4gICAgcmV0dXJuO1xuICB9XG4gIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2FsbGJhY2spO1xufVxuXG4vLyBDcmVhdGUgYW4gaW5zdGFuY2Ugb2YgQ2FsY3VsYXRvckFwcCBhbmQgYmluZCBpdCB0byBhbiBzdmdfZG9jdW1lbnRcbmZ1bmN0aW9uIGJpbmRDYWxjdWxhdG9yQXBwKHN2Z19kb2N1bWVudCkge1xuICB2YXIgZGlzcGxheV9lbGVtZW50ID0gc3ZnX2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZGlzcGxheVwiKTtcbiAgaWYgKGRpc3BsYXlfZWxlbWVudCA9PSBudWxsKSB7XG4gICAgY29uc29sZS5lcnJvcihcImRpc3BsYXkgbm90IGZvdW5kXCIpO1xuICAgIHJldHVybjtcbiAgfVxuICB2YXIgZGlzcGxheSA9IG5ldyBUZXh0RGlzcGxheShkaXNwbGF5X2VsZW1lbnQpO1xuICB2YXIgY2FsY3VsYXRvciA9IG5ldyBDYWxjdWxhdG9yQXBwKGRpc3BsYXkpO1xuXG4gIC8vIEFkZCB0aGUgMC05IGRpZ2l0IGJ1dHRvbnNcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgdmFyIGRpZ2l0ID0gU3RyaW5nKGkpO1xuICAgIHZhciBidXR0b25fbmFtZSA9IFwiYnV0dG9uX1wiICsgZGlnaXQ7XG4gICAgYmluZEJ1dHRvbihzdmdfZG9jdW1lbnQsIGJ1dHRvbl9uYW1lLCBkaWdpdF9jYWxsYmFjayhjYWxjdWxhdG9yLCBkaWdpdCkpO1xuICB9XG5cbiAgLy8gQWxsIHRoZSBvdGhlciBidXR0b25zXG4gIGJpbmRCdXR0b24oc3ZnX2RvY3VtZW50LCBcImJ1dHRvbl9kZWNpbWFsXCIsIGZ1bmN0aW9uKCkge1xuICAgIGNhbGN1bGF0b3IuZGVjaW1hbCgpO1xuICB9KTtcbiAgYmluZEJ1dHRvbihzdmdfZG9jdW1lbnQsIFwiYnV0dG9uX2FkZFwiLCBmdW5jdGlvbigpIHtcbiAgICBjYWxjdWxhdG9yLmFkZF9vcCgpO1xuICB9KTtcbiAgYmluZEJ1dHRvbihzdmdfZG9jdW1lbnQsIFwiYnV0dG9uX3N1YlwiLCBmdW5jdGlvbigpIHtcbiAgICBjYWxjdWxhdG9yLnN1Yl9vcCgpO1xuICB9KTtcbiAgYmluZEJ1dHRvbihzdmdfZG9jdW1lbnQsIFwiYnV0dG9uX211bFwiLCBmdW5jdGlvbigpIHtcbiAgICBjYWxjdWxhdG9yLm11bF9vcCgpO1xuICB9KTtcbiAgYmluZEJ1dHRvbihzdmdfZG9jdW1lbnQsIFwiYnV0dG9uX2RpdlwiLCBmdW5jdGlvbigpIHtcbiAgICBjYWxjdWxhdG9yLmRpdl9vcCgpO1xuICB9KTtcbiAgYmluZEJ1dHRvbihzdmdfZG9jdW1lbnQsIFwiYnV0dG9uX2VudGVyXCIsIGZ1bmN0aW9uKCkge1xuICAgIGNhbGN1bGF0b3IuZW50ZXIoKTtcbiAgfSk7XG4gIGJpbmRCdXR0b24oc3ZnX2RvY3VtZW50LCBcImJ1dHRvbl9jbGVhclwiLCBmdW5jdGlvbigpIHtcbiAgICBjYWxjdWxhdG9yLmNsZWFyKCk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBpbml0KCkge1xuICB2YXIgYXNzZXRfbWFwID0gbmV3IGlseWFfbm9kZS5TdGF0aWNBc3NldE1hcCgpO1xuICB2YXIgc3ZnX29iamVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3ZnX29iamVjdFwiKTtcbiAgaWYgKHN2Z19vYmplY3QgPT0gbnVsbCkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJzdmdfb2JqZWN0IG5vdCBmb3VuZCFcIik7XG4gICAgcmV0dXJuO1xuICB9XG4gIHN2Z19vYmplY3QuaW5uZXJIVE1MID0gYXNzZXRfbWFwLmdldChcImxheW91dC5zdmdcIik7XG4gIGJpbmRDYWxjdWxhdG9yQXBwKGRvY3VtZW50KTtcbn1cblxuaW5pdCgpO1xuIl0sImZpbGUiOiJhcHAuanMifQ==
